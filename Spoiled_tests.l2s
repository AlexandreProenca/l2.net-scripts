// Kratky popis
// anickaaa :*
// Server: 
// Autor: mochitto
// Date: 
// Special thanks for L2.NET contributors
// rev.: 0
PRINT_TEXT "SCRIPT STARTED!]"
SET_EVENT "<&SCRIPTEVENT_SERVERPACKET&>" "<&SYSTEM_CURRENTFILE&>" DIE 0
SET_EVENT "<&SCRIPTEVENT_SERVERPACKET&>" "<&SYSTEM_CURRENTFILE&>" REMOVE_NPCS 8
INCLUDE "StdLib\NPC.l2c"

// Main section
// ===============================
DEFINE_GLOBAL ARRAYLIST SWEEPABLE_NPCS
DEFINE_GLOBAL INT PROCESS

//THREAD SPOIL
//TODO REMOVE NCP FROM LIST BY DELETE OBJECT PACKET

DO 
	SWEEP_MOBS
	SLEEP 100
LOOP ONE == ONE

//sleep 123819
PRINT_TEXT "SCRIPT STOPED!]"
END_SCRIPT

FUNCTION REMOVE_NPCS
	DEFINE INT OBJ_ID
	DEFINE ARRAYLIST NPCS
	
	PACKET.READ_BYTE NULL
    PACKET.READ_INT32 OBJ_ID
    
    FOREACH A INT SWEEPABLE_NPCS  		
		IF OBJ_ID == SWEEPABLE_NPCS.A
			PRINT_TEXT "<&SWEEPABLE_NPCS.A&>"
			TARGET "<&SWEEPABLE_NPCS.A&>"
			SWEEPABLE_NPCS.REMOVE A
			BREAK 2
		ENDIF
	NEXTEACH 	
RETURN VOID

FUNCTION SPOIL
	DEFINE ARRAYLIST NPCS
	DEFINE INT DIST
	DO 
		GET_NPCS NPCS
		FOREACH A NPC NPCS 
			NPCS.A.DIST DIST 0	
			PRINT_TEXT "<&NPCS.A.HP&>"
			IF ( DIST < 200 ) && ( PROCESS != TRUE )
				PRINT_TEXT "TARGET -> <&NPCS.A.ID&>"
				TARGET "<&NPCS.A.ID&>"
				USE_SKILL_SMART 302
				SLEEP 2000
				BREAK 2
			ENDIF
		NEXTEACH
		SLEEP 25
	LOOP ONE == ONE
RETURN VOID

FUNCTION DIE
	DEFINE INT OBJ_ID
	DEFINE INT SWEEPABLE
	
	PACKET.READ_BYTE NULL     // writeC(0x00)
	PACKET.READ_INT32 OBJ_ID  // writeD(_charObjId);
	PACKET.READ_INT32 NULL    // writeD(_canTeleport ? 0x01 : 0);  
	PACKET.READ_INT32 NULL    // writeD(0x00); 
	PACKET.READ_INT32 NULL    // writeD(0x00); 
	PACKET.READ_INT32 NULL    // writeD(0x00); 
	PACKET.READ_INT32 SWEEPABLE // writeD(_sweepable ? 0x01 : 0x00);
	//PACKET.READ_INT32 NULL    // writeD(_access.allowFixedRes() ? 0x01: 0x00);
	//PACKET.READ_INT32 NULL    // writeD(0x00); 
	IF SWEEPABLE == TRUE
		SWEEPABLE_NPCS.ADD OBJ_ID
		PRINT_TEXT "ADD <&OBJ_ID&>"
	ENDIF 
RETURN VOID

FUNCTION SWEEP_MOBS
	DEFINE INT REUSE 0
	DEFINE ARRAYLIST NPCS
	IF PROCESS == TRUE
		RETURN VOID
	ENDIF
	PROCESS = TRUE
	GET_NPCS NPCS
	//FOREACH A INT SWEEPABLE_NPCS
	FOR A 0 "<&SWEEPABLE_NPCS.COUNT&>" 1  
		FOREACH B NPC NPCS  		
			IF NPCS.B.ID == SWEEPABLE_NPCS.A
				PRINT_TEXT "TARGET -> <&SWEEPABLE_NPCS.A&>"
				TARGET "<&SWEEPABLE_NPCS.A&>"
				PRINT_TEXT "SWEEP -> <&SWEEPABLE_NPCS.A&>"
				USE_SKILL_SMART 42
				//SWEEPABLE_NPCS.REMOVE A
				BREAK 3
			ENDIF
		NEXTEACH
	NEXT
	PROCESS = FALSE
	//SWEEPABLE_NPCS.CLEAR
RETURN VOID