SET_EVENT "<&SCRIPTEVENT_SERVERPACKET&>" "<&SYSTEM_CURRENTFILE&>" html 25
SET_EVENT "<&SCRIPTEVENT_SERVERPACKETEX&>" "<&SYSTEM_CURRENTFILE&>" exhtml 141  

DEFINE_GLOBAL STRING _html 0
DEFINE_GLOBAL INT ObjID 0
DEFINE_GLOBAL INT Count 0
DEFINE_GLOBAL WINDOW okno HTML  
DEFINE_GLOBAL INT rand 0
GET_RAND rand 0 5000
Count = rand

okno.SET_NAME "Html get"
okno.SET_HTML ""
okno.RUN_WINDOW
                 
WHILE ZERO == ZERO
	SLEEP 1000
WEND

FUNCTION html
	PACKET.READ_BYTE NULL
	PACKET.READ_INT32 ObjID
	PACKET.READ_STRING _html
	
	Count = Count + #i1
	WRITE_LOG
	//sdfsdf
RETURN VOID

FUNCTION exhtml
	PACKET.READ_BYTE NULL
	PACKET.READ_INT16 NULL
	PACKET.READ_INT32 ObjID
	PACKET.READ_STRING _html
	
	Count = Count + #i1
	WRITE_LOG
	//PRINT_TEXT "#$ <&_html&>"
RETURN VOID

FUNCTION WRITE_LOG
    PRINT_TEXT "saved as <&ObjID&>_<&Count&>.txt"
    okno.SET_HTML "<&_html&>"
	DEFINE FILEWRITER _fwopened "<&ObjID&>_<&Count&>.txt"
	_fwopened.WRITE _html
	_fwopened.FLUSH
	_fwopened.CLOSE
RETURN VOID